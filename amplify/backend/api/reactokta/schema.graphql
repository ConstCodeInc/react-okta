# This "input" configures a global authorization rule to enable public access to
# all models in this schema. Learn more about authorization rules here: https://docs.amplify.aws/cli/graphql/authorization-rules
input AMPLIFY {
  globalAuthRule: AuthRule = { allow: public }
} # FOR TESTING ONLY!
type Todo @model @auth(rules: [{ allow: private }]) {
  id: ID!
  task: String
}

type Artist
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["Admin"] }
      { allow: private, operations: [read] }
    ]
  ) {
  id: ID! @primaryKey
  first_name: String
  talent_genre: [ArtistGenre]
    @hasMany(indexName: "byArtistGenreByArtistId", fields: ["id"])
  talent_label: [ArtistLabel]
    @hasMany(indexName: "byArtistLabelByArtistId", fields: ["id"])
}

type Genre
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["Admin"] }
      { allow: public, operations: [read] }
      { allow: private, operations: [read] }
    ]
  ) {
  id: ID! @primaryKey
  genre: ID! @index(name: "byGenreByGenre", queryField: "getGenreByGenre")
  talent_genre: [ArtistGenre]
    @hasMany(indexName: "byArtistGenreByGenreId", fields: ["genre"])
}
type GenreConnection {
  getGenresByName: [Genre]
  nextToken: String
}

type ArtistGenre
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["Admin"] }
      { allow: private, operations: [read] }
    ]
  ) {
  id: ID! @primaryKey
  artist_id: ID
    @index(
      name: "byArtistGenreByArtistId"
      queryField: "getArtistGenreByArtistId"
    )
  genre_id: ID
    @index(
      name: "byArtistGenreByGenreId"
      queryField: "getArtistGenreByGenreId"
    )
  talent: Artist @belongsTo(fields: ["artist_id"])
  genre: Genre @belongsTo(fields: ["genre_id"])
}

type Label
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["Admin"] }
      { allow: private, operations: [read] }
    ]
  ) {
  id: ID! @primaryKey
  label: ID! @index(name: "byLabelByLabel", queryField: "getLabelByLabel")
  talent_label: [ArtistLabel]
    @hasMany(indexName: "byArtistLabelByLabelId", fields: ["label"])
}

type ArtistLabel
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["Admin"] }
      { allow: private, operations: [read] }
    ]
  ) {
  id: ID! @primaryKey
  artist_id: ID
    @index(
      name: "byArtistLabelByArtistId"
      queryField: "getArtistLabelByArtistId"
    )
  label_id: ID
    @index(
      name: "byArtistLabelByLabelId"
      queryField: "getArtistLabelByLabelId"
    )
  talent: Artist @belongsTo(fields: ["artist_id"])
  label: Label @belongsTo(fields: ["label_id"])
}

type Query {
  # getArtistsByGenresAndLabels(genreNames: [String]!, labelNames: [String]!): [Artist] @aws_api_key @aws_cognito_user_pools
  getGenresByName(
    genreNames: [String]!
    limit: Int
    nextToken: String
  ): GenreConnection
  getLabelsByName(labelNames: [String]!): [Label]
  getArtistsByGenresAndLabelsTwo(
    genreNames: [String]!
    labelNames: [String]!
  ): [String] @function(name: "artistProcessor-${env}")
}
